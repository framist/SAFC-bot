<html lang="en">
<!-- SAFC web demo
     this page's source code fork from https://gitee.com/wdwdwd123/RateMySupervisor
     æ•°æ®å·²å¼€æºã€‚è¯·çæƒœæœåŠ¡å™¨ï¼Œä¸è¦çˆ¬å–æ•°æ®    
-->

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>SAFC - æŸ¥çœ‹å¯¼å¸ˆè¯„ä»·</title>

    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="text-center">
        <h1>ğŸ›ï¸</h1>
        <h1>SAFC - Web</h1>
        <p>
            <b>å¤§å­¦ç”Ÿåè¯ˆä¸­å¿ƒ web ç«¯</b><br />
            <i>ç¤¾ç¾¤ï¼Œå®‰å…¨ï¼Œå¼€æºâ€”â€”ä¸åªæ˜¯è¯„ä»·å¯¼å¸ˆ</i><br />
            <!-- <a href="https://t.me/SAFC_bot"><del>Telegram æœºå™¨äºº</del></a> | -->
            Webï¼ˆæœ¬ç«™ï¼‰ |
            <a href="https://t.me/SAFC_bak_bot">Telegram æœºå™¨äºº</a> |
            <a href="https://t.me/SAFC_group">ç¾¤ç»„ç¤¾åŒº</a> |
            <a href="https://github.com/framist/SAFC-bot"> GitHub</a> <br />
        </p>
    </div>

    
    <div class="container mt-3">
        <div class="comments-info mb-3">
            <div class="row">
                <div class="col align-self-start" id="db-status">
                    è¿æ¥æ•°æ®åº“ä¸­ â€¦â€¦
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col col-6">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <label class="input-group-text" for="schoolcateSelector">æ ¡åˆ«</label>
                    </div>
                    <select class="custom-select" id="schoolcateSelector">
                        <option selected>å­¦æ ¡ç±»åˆ«</option>
                    </select>
                </div>
            </div>
            <div class="col col-6">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <label class="input-group-text" for="universitySelector">å­¦æ ¡</label>
                    </div>
                    <select class="custom-select" id="universitySelector">
                        <option selected>æ‰€åœ¨å­¦æ ¡</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col col-6">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <label class="input-group-text" for="departmentSelector">é™¢ç³»</label>
                    </div>
                    <select class="custom-select" id="departmentSelector">
                        <option selected>æ‰€åœ¨é™¢ç³»</option>
                    </select>
                </div>
            </div>
            <div class="col col-6">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <label class="input-group-text" for="supervisorSelector">å¯¼å¸ˆ</label>
                    </div>
                    <select class="custom-select" id="supervisorSelector">
                        <option selected>å§“å</option>
                    </select>
                </div>
            </div>

        </div>

        <div class="comments-info mb-3">
            <div class="row">
                <div class="col align-self-start" id="comments-num">
                    æ£€ç´¢åˆ° 0 æ¡è¯„è®º
                </div>
            </div>
        </div>
        <div class="descriptions">
        </div>
    </div>

    <div class="text-center">
        <!-- <i>this page's source code fork from <a href="https://gitee.com/wdwdwd123/RateMySupervisor">RateMySupervisor</a>
        </i> <br> -->
        <i>web ç«¯ä»åœ¨å¼€å‘ä¸­ ğŸ§ª å¢åŠ å¯¼å¸ˆã€å¢åŠ è¯„ä»·ã€åµŒå¥—è¯„ä»·ç­‰æ›´å¤šåŠŸèƒ½è¯·ä½¿ç”¨ <a href="https://t.me/SAFC_bak_bot"> bot </a>ï¼</i>  <br /> 
        <!-- <a href="https://github.com/framist/SAFC-bot">SAFC</a> - ç¤¾ç¾¤ï¼Œä¿æŠ¤ï¼Œå¼€æ”¾ -->
    </div>

    <script>
        function setSelectOptions(selector, options) {
            selector.empty();
            options.forEach(function (value, i) {
                var option = new Option(value, i);
                selector.append($(option));
            });
        }

        /* {
            "0": {
                "object": "6f0980001ddd0b4d",
                "description": "å¯¼å¸ˆè¾¨è¯†ç‰¹å¾ï¼šè€å¹´çœ¼ç›ç”·ï¼Œå‘é‡å°‘<br><br>å­¦æœ¯æ°´å¹³ï¼šçº¯å±å¿µä¹¦è®²è¯¾å‹ï¼Œè¿‘å‡ å¹´æ¯«æ— ç§‘ç ”äº§å‡ºï¼Œä¹Ÿæ²¡æœ‰æœ‰ä»·å€¼çš„è¯¾é¢˜ç ”ç©¶é¡¹ç›®<br><br>ç§‘ç ”ç»è´¹ï¼šæ— ç§‘ç ”ç»è´¹ï¼Œæ„Ÿè§‰æƒ³è‡ªå·±æ··é€€ä¼‘çš„æ ·å­ï¼Œä¸ä¸ºå­¦ç”Ÿå‰é€”è€ƒè™‘<br><br>å­¦ç”Ÿè¡¥åŠ©ï¼šæ— å­¦ç”Ÿè¡¥åŠ©<br><br>å¸ˆç”Ÿå…³ç³»ï¼šè·Ÿè¿™ç§è€å¸ˆè¿˜ä¸å¦‚è‡ªå·±å­¦ï¼Œæ²¡æƒ³åˆ°äº¤å¤§è¿˜æœ‰è¿™ç§è€å¸ˆï¼ŒçœŸæƒ³æƒ³ç ”ç©¶ç”Ÿé™¢ä¸¾æŠ¥å•Šï¼Œè¿™ç§è€å¸ˆçœŸçš„è¯¯äººå­å¼Ÿå•Š<br><br>å­¦ç”Ÿå‰é€”ï¼šæ— å‰é€”å¯è¨€ï¼Œæ··æ—¶é—´ï¼Œä¸ä¸€å®šèƒ½æ¯•ä¸šï¼Œè¿›è¿™ä¸ªè¯¾é¢˜ç»„çœŸçš„åæ‚”é˜¿ï¼Œè¿˜ä¸å¦‚å½“åˆæ‰¾ä¸ªåŒéå­¦æ ¡çš„è´Ÿè´£äººçš„è€å¸ˆèƒ½å­¦åˆ°ä¸œè¥¿ï¼ï¼",
                "date": "2020-03",
                "source_cate": "Urfire",
                "comment_type": "Teacher",
                "author_sign": null,
                "id": "48139cef162977f9"
            }
        }*/
        function show_comments() {
            contentDiv.empty();
            currentCm.forEach(function (value, i) {
                var desc = value['description'];
                // .replace(/<br>/g, '\n');
                var card = $(`<div class="card mb-3">
                <div class="card-header">
                    <div class="row">
                        <div class="col">
                            <b> ${i + 1} | ${currentSp} - <code>${value['object']}</code> </b>
                        </div>
                        <div class="col" style="text-align: right;">
                            <b>${value['comment_type']} | ${value['date']}</b>
                        </div>
                    </div>
                </div>
                    <div class="card-body">
                        <p class="card-title">æ¥è‡ª ${value['source_cate']} çš„è¯„ä»· - <code>${value['id']}</code></p>
                        <p class="card-text">${desc}</p>
                    </div>
                </div >`);
                contentDiv.append($(card));
            })
        }

        //Selectors
        var schoolcate_sel = $('#schoolcateSelector');
        var university_sel = $('#universitySelector');
        var department_sel = $('#departmentSelector');
        var supervisor_sel = $('#supervisorSelector');
        //Buttons and Divs
        var contentDiv = $('.descriptions');
        var commentsNumDiv = $('#comments-num');
        var statusDiv = $('#db-status');
        //Initialize selection conditions
        var schoolcates = new Array();
        var universities = new Array();
        var departments = new Array();
        var supervisors = new Array();
        var currentCt = '';
        var currentUn = '';
        var currentDp = '';
        var currentSp = '';
        var currentCm = new Array();

        const API_URL = "https://safc.framist.top/api/query";

        $.get("https://safc.framist.top/api", (d) => {
            statusDiv.empty();
            statusDiv.append(`${d}`);
        }).fail(() => {
            statusDiv.empty();
            statusDiv.append(`ğŸ˜¢ å¯èƒ½åç«¯æœåŠ¡å™¨å‡ºæ•…éšœäº† ğŸ é€Ÿé€Ÿæ‹·æ‰“<a href="https://t.me/SAFC_admin">ç®¡ç†å‘˜</a>`);
        });

        $.get(API_URL, (d) => {
            schoolcates = d;
            setSelectOptions(schoolcate_sel, schoolcates);
            schoolcate_sel.trigger('change');
        });            

        //Selector change 

        schoolcate_sel.change(() => {
            currentCt = schoolcates[schoolcate_sel.val()];
            $.get(API_URL, { school_cate: currentCt }, (d) => {
                universities = d;
                setSelectOptions(university_sel, universities);
                university_sel.trigger('change');
            });
        });

        university_sel.change(() => {
            currentUn = universities[university_sel.val()];
            $.get(API_URL,
                { school_cate: currentCt, university: currentUn },
                (d) => {
                    console.log(d);
                    departments = d;
                    setSelectOptions(department_sel, departments);
                    department_sel.trigger('change');
                }
            );
        });

        department_sel.change(() => {
            currentDp = departments[department_sel.val()];
            $.get(API_URL,
                { school_cate: currentCt, university: currentUn, department: currentDp },
                (d) => {
                    console.log(d);
                    supervisors = d;
                    setSelectOptions(supervisor_sel, supervisors);
                    supervisor_sel.trigger('change');
                }
            );
        })
        supervisor_sel.change(() => {
            currentSp = supervisors[supervisor_sel.val()];
            $.get(API_URL,
                {
                    school_cate: currentCt,
                    university: currentUn,
                    department: currentDp,
                    supervisor: currentSp,
                },
                (d) => {
                    console.log(d);
                    currentCm = d;
                    counts = currentCm.length;
                    commentsNumDiv.empty();
                    commentsNumDiv.append(`æ£€ç´¢åˆ° ${counts} æ¡è¯„è®º`);
                    show_comments();
                }
            );
        })
    </script>
</body>


</html>