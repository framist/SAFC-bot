<html lang="en">
<!-- SAFC web demo
     this page's source code fork from https://gitee.com/wdwdwd123/RateMySupervisor
     æƒ³çˆ¬æ•°æ®å¤–ä¹Ÿå¯ä»¥ç›´æ¥é—®æˆ‘è¦
-->

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>SAFC - æŸ¥çœ‹å¯¼å¸ˆè¯„ä»·</title>

    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="text-center">
        <h1>ğŸ›ï¸</h1>
        <h1>SAFC - Web</h1>
        <p>
            <b>å¤§å­¦ç”Ÿåè¯ˆä¸­å¿ƒ web ç«¯</b><br />
            <i>å…ƒå¹³å°ã€åˆ†å¸ƒå¼â€”â€”ä¸åªæ˜¯è¯„ä»·å¯¼å¸ˆ</i><br />
            <!-- <a href="https://t.me/SAFC_bot"><del>Telegram æœºå™¨äºº</del></a> | -->
            Webï¼ˆæœ¬ç«™ï¼‰ |
            <a href="https://t.me/SAFC_bak_bot">Telegram æœºå™¨äºº</a> |
            <a href="https://t.me/SAFC_group">ç¾¤ç»„ç¤¾åŒº</a> |
            <a href="https://github.com/framist/SAFC-bot"> GitHub</a> <br />
        </p>
    </div>

    
    <div class="container mt-3">
        <div class="comments-info mb-3">
            <div class="row">
                <div class="col align-self-start" id="db-status">
                    è¿æ¥æ•°æ®åº“ä¸­ â€¦â€¦
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col col-6">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <label class="input-group-text" for="schoolcateSelector">æ ¡åˆ«</label>
                    </div>
                    <select class="custom-select" id="schoolcateSelector">
                        <option selected>å­¦æ ¡ç±»åˆ«</option>
                    </select>
                </div>
            </div>
            <div class="col col-6">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <label class="input-group-text" for="universitySelector">å­¦æ ¡</label>
                    </div>
                    <select class="custom-select" id="universitySelector">
                        <option selected>æ‰€åœ¨å­¦æ ¡</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col col-6">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <label class="input-group-text" for="departmentSelector">é™¢ç³»</label>
                    </div>
                    <select class="custom-select" id="departmentSelector">
                        <option selected>æ‰€åœ¨é™¢ç³»</option>
                    </select>
                </div>
            </div>
            <div class="col col-6">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <label class="input-group-text" for="supervisorSelector">å¯¼å¸ˆ</label>
                    </div>
                    <select class="custom-select" id="supervisorSelector">
                        <option selected>å§“å</option>
                    </select>
                </div>
            </div>

        </div>

        <div class="comments-info mb-3">
            <div class="row">
                <div class="col align-self-start" id="comments-num">
                    æ£€ç´¢åˆ° 0 æ¡è¯„è®º
                </div>
            </div>
        </div>
        <div class="descriptions">
        </div>
    </div>

    <div class="text-center">
        <!-- <i>this page's source code fork from <a href="https://gitee.com/wdwdwd123/RateMySupervisor">RateMySupervisor</a>
        </i> <br> -->
        <i>web ç«¯ç°åªæä¾›åŸºæœ¬çš„æŸ¥çœ‹åŠŸèƒ½ï¼Œæ•°æ®çº¦æ»åä¸€æ—¥<br /> 
            å¢åŠ å¯¼å¸ˆã€å¢åŠ è¯„ä»·ã€æŸ¥çœ‹ä¸å¢åŠ åµŒå¥—è¯„ä»·ç­‰æ›´å¤šåŠŸèƒ½è¯·ä½¿ç”¨ <a href="https://t.me/SAFC_bak_bot"> bot </a>ï¼</i>  <br /> 
        <!-- <a href="https://github.com/framist/SAFC-bot">SAFC</a> - ç¤¾ç¾¤ï¼Œä¿æŠ¤ï¼Œå¼€æ”¾ -->
    </div>

    <script>
        function setSelectOptions(selector, options) {
            selector.empty();
            options.forEach(function (value, i) {
                var option = new Option(value, i);
                selector.append($(option));
            });
        }

        function show_comments() {
            contentDiv.empty();
            currentCm.forEach(function (value, i) {
                var desc = value['description'].replace(/\n/g, "<br>");
                var card = $(`<div class="card mb-3">
                <div class="card-header">
                    <div class="row">
                        <div class="col">
                            <b> ${i + 1} | ${currentSp} - <code>${value['object']}</code> </b>
                        </div>
                        <div class="col" style="text-align: right;">
                            <b>${value['comment_type']} | ${value['date']}</b>
                        </div>
                    </div>
                </div>
                    <div class="card-body">
                        <p class="card-title">æ¥è‡ª ${value['source_cate']} çš„è¯„ä»· - <code>${value['id']}</code></p>
                        <p class="card-text">${desc}</p>
                        <div class="nest-descriptions">
                            <!-- todo -->
                        </div>
                    </div>
                </div >`);
                if (currentUn == 'è¥¿å®‰ç”µå­ç§‘æŠ€å¤§å­¦') {
                    // ä½ æ‡‚çš„
                    card = $(`<div class="card mb-3">
                        <div class="card-header">
                            <div class="row">
                                <div class="col">
                                    <b> ä¸äºˆæ˜¾ç¤º </b>
                                </div>
                            </div>
                        </div>`);
                }
                contentDiv.append($(card));
            })
        }

        //Selectors
        var schoolcate_sel = $('#schoolcateSelector');
        var university_sel = $('#universitySelector');
        var department_sel = $('#departmentSelector');
        var supervisor_sel = $('#supervisorSelector');
        //Buttons and Divs
        var contentDiv = $('.descriptions');
        var commentsNumDiv = $('#comments-num');
        var statusDiv = $('#db-status');
        //Initialize selection conditions
        var schoolcates = new Array();
        var universities = new Array();
        var departments = new Array();
        var supervisors = new Array();
        var currentCt = '';
        var currentUn = '';
        var currentDp = '';
        var currentSp = '';
        var currentCm = new Array();

        const API_URL = "https://safc.framist.top/api/query";

        $.get("https://safc.framist.top/api", (d) => {
            statusDiv.empty();
            statusDiv.append(`${d}`);
        }).fail(() => {
            statusDiv.empty();
            statusDiv.append(`ğŸ˜¢ å¯èƒ½åç«¯æœåŠ¡å™¨å‡ºæ•…éšœäº† ğŸ é€Ÿé€Ÿæ‹·æ‰“<a href="https://t.me/SAFC_admin">ç®¡ç†å‘˜</a>`);
        });

        $.get(API_URL, (d) => {
            schoolcates = d;
            setSelectOptions(schoolcate_sel, schoolcates);
            schoolcate_sel.trigger('change');
        });            

        //Selector change 

        schoolcate_sel.change(() => {
            currentCt = schoolcates[schoolcate_sel.val()];
            $.get(API_URL, { school_cate: currentCt }, (d) => {
                universities = d;
                setSelectOptions(university_sel, universities);
                university_sel.trigger('change');
            });
        });

        university_sel.change(() => {
            currentUn = universities[university_sel.val()];
            $.get(API_URL,
                { school_cate: currentCt, university: currentUn },
                (d) => {
                    departments = d;
                    setSelectOptions(department_sel, departments);
                    department_sel.trigger('change');
                }
            );
        });

        department_sel.change(() => {
            currentDp = departments[department_sel.val()];
            $.get(API_URL,
                { school_cate: currentCt, university: currentUn, department: currentDp },
                (d) => {
                    supervisors = d;
                    setSelectOptions(supervisor_sel, supervisors);
                    supervisor_sel.trigger('change');
                }
            );
        })
        supervisor_sel.change(() => {
            currentSp = supervisors[supervisor_sel.val()];
            $.get(API_URL,
                {
                    school_cate: currentCt,
                    university: currentUn,
                    department: currentDp,
                    supervisor: currentSp,
                },
                (d) => {
                    currentCm = d;
                    counts = currentCm.length;
                    commentsNumDiv.empty();
                    commentsNumDiv.append(`æ£€ç´¢åˆ° ${counts} æ¡è¯„è®º`);
                    show_comments();
                }
            );
        })
    </script>
</body>


</html>